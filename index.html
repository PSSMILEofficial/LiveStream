<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Live Chat System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    body { font-family: Arial; padding: 10px; background: #f5f5f5; }
    #chatBox {
        height: 350px;
        background: white;
        border: 1px solid #222;
        padding: 10px;
        overflow-y: auto;
        font-size: 16px;
    }
    .systemMsg {
        color: gray;
        font-style: italic;
        margin: 5px 0;
    }
    #clearBtn {
        display: none;
        margin-top: 10px;
        padding: 8px 15px;
        background: red;
        color: white;
        border: none;
        cursor: pointer;
    }
</style>
</head>
<body>

<h2>Live Chat</h2>

<div id="chatBox"></div>

<br>

<input id="nameInput" placeholder="Enter Name" style="width:30%;padding:8px;">
<input id="msgInput" placeholder="Enter Message" style="width:45%;padding:8px;">
<button onclick="sendMessage()" style="padding:8px;">Send</button>

<button id="clearBtn" onclick="clearChat()">Clear Chat (Admin Only)</button>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

<script>
// --------------------------------------------------
//  FIREBASE CONFIG (PUT YOUR CONFIG HERE)
// --------------------------------------------------
const firebaseConfig = {
    apiKey: "YOUR_KEY",
    authDomain: "YOUR_APP.firebaseapp.com",
    databaseURL: "https://YOUR_APP-default-rtdb.firebaseio.com",
    projectId: "YOUR_APP",
    storageBucket: "YOUR_APP.appspot.com",
    messagingSenderId: "XXXX",
    appId: "XXXX"
};
// --------------------------------------------------

const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --------------------------------------------------
//  USER SETUP
// --------------------------------------------------
let userName = localStorage.getItem("chatUser");
let userColor = localStorage.getItem("chatColor");

if (!userName) {
    userName = "Viewer" + Math.floor(Math.random() * 9999);
    localStorage.setItem("chatUser", userName);
}

if (userName.toLowerCase() === "admin") {
    userColor = "red";
    document.getElementById("clearBtn").style.display = "inline-block";  // show clear button
} else {
    if (!userColor) {
        userColor = "#" + Math.floor(Math.random() * 16777215).toString(16);
        localStorage.setItem("chatColor", userColor);
    }
}

document.getElementById("nameInput").value = userName;

// --------------------------------------------------
//  SEND USER MESSAGE
// --------------------------------------------------
function sendMessage() {
    const name = document.getElementById("nameInput").value.trim();
    const msg = document.getElementById("msgInput").value.trim();

    if (msg === "") return;

    db.ref("liveChat/messages").push({
        name: name,
        text: msg,
        color: (name.toLowerCase() === "admin") ? "red" : userColor,
        type: "user"
    });

    document.getElementById("msgInput").value = "";
}

// --------------------------------------------------
//  SYSTEM MESSAGE (SHOWS TIME)
// --------------------------------------------------
function sendSystemMessage(text) {
    const time = new Date().toLocaleTimeString();

    db.ref("liveChat/messages").push({
        name: "SYSTEM",
        text: `${text} (${time})`,
        color: "gray",
        type: "system"
    });
}

// --------------------------------------------------
//  ADMIN CLEAR CHAT
// --------------------------------------------------
function clearChat() {
    if (userName.toLowerCase() !== "admin") return;

    // Delete entire chat tree
    db.ref("liveChat/messages").remove();

    // Add system message
    sendSystemMessage("Chat was cleared by Admin");
}

// --------------------------------------------------
//  DISPLAY CHAT LIVE
// --------------------------------------------------
db.ref("liveChat/messages").on("child_added", (data) => {
    const msg = data.val();
    const box = document.getElementById("chatBox");

    let div = document.createElement("div");

    if (msg.type === "system") {
        div.className = "systemMsg";
        div.innerHTML = msg.text;
    } else {
        div.innerHTML = `<b style="color:${msg.color}">${msg.name}</b>: ${msg.text}`;
    }

    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
});

// --------------------------------------------------
//  CLEAR LOCAL CHAT BOX WHEN DB CLEARS
// --------------------------------------------------
db.ref("liveChat/messages").on("value", () => {
    const box = document.getElementById("chatBox");
    box.innerHTML = "";
});
</script>

</body>
</html>
