<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Live Chat System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    body { font-family: Arial; padding: 10px; background: #f5f5f5; }
    #chatBox {
        height: 350px;
        background: white;
        border: 1px solid #222;
        padding: 10px;
        overflow-y: auto;
        font-size: 16px;
    }
    .systemMsg {
        color: gray;
        font-style: italic;
        margin: 5px 0;
    }
</style>
</head>
<body>

<h2>Live Chat</h2>

<div id="chatBox"></div>

<br>

<input id="nameInput" placeholder="Enter Name" style="width:30%;padding:8px;">
<input id="msgInput" placeholder="Enter Message" style="width:45%;padding:8px;">
<button onclick="sendMessage()" style="padding:8px;">Send</button>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

<script>
// --------------------------------------------------
//  FIREBASE CONFIG (PUT YOUR CONFIG HERE)
// --------------------------------------------------
const firebaseConfig = {
    apiKey: "YOUR_KEY",
    authDomain: "YOUR_APP.firebaseapp.com",
    databaseURL: "https://YOUR_APP-default-rtdb.firebaseio.com",
    projectId: "YOUR_APP",
    storageBucket: "YOUR_APP.appspot.com",
    messagingSenderId: "XXXX",
    appId: "XXXX"
};
// --------------------------------------------------

const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --------------------------------------------------
//  USER SETUP
// --------------------------------------------------
let userName = localStorage.getItem("chatUser");
let userColor = localStorage.getItem("chatColor");

if (!userName) {
    userName = "Viewer" + Math.floor(Math.random() * 9999);
    localStorage.setItem("chatUser", userName);
}

if (userName.toLowerCase() === "admin") {
    userColor = "red";  // admin is always red
} else {
    if (!userColor) {
        userColor = "#" + Math.floor(Math.random() * 16777215).toString(16);
        localStorage.setItem("chatColor", userColor);
    }
}

document.getElementById("nameInput").value = userName;

// --------------------------------------------------
//  SEND MESSAGE
// --------------------------------------------------
function sendMessage() {
    const name = document.getElementById("nameInput").value.trim();
    const msg = document.getElementById("msgInput").value.trim();

    if (name === "" || msg === "") return;

    localStorage.setItem("chatUser", name);

    db.ref("liveChat/messages").push({
        name: name,
        text: msg,
        color: (name.toLowerCase() === "admin") ? "red" : userColor,
        time: Date.now(),
        type: "user"
    });

    document.getElementById("msgInput").value = "";
}

// --------------------------------------------------
//  SYSTEM MESSAGE WITH TIME
// --------------------------------------------------
function sendSystemMessage(text) {
    const now = new Date();
    const formattedTime = now.toLocaleTimeString();

    db.ref("liveChat/messages").push({
        name: "SYSTEM",
        text: text + " (" + formattedTime + ")",
        color: "gray",
        type: "system"
    });
}

// Example: system message on load
sendSystemMessage("User connected");

// --------------------------------------------------
//  DISPLAY MESSAGES LIVE
// --------------------------------------------------
db.ref("liveChat/messages").on("child_added", (data) => {
    const msg = data.val();
    const box = document.getElementById("chatBox");

    let div = document.createElement("div");

    if (msg.type === "system") {
        div.className = "systemMsg";
        div.innerHTML = msg.text;
    } else {
        div.innerHTML = `<b style="color:${msg.color}">${msg.name}</b>: ${msg.text}`;
    }

    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
});
</script>

</body>
</html>
